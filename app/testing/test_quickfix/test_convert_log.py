from nose.tools import assert_dict_equal
import tempfile
from app import FIX
from unittest import *
from app.FIX.client.log import convert_log

def setup():
    fakelog = tempfile.TemporaryFile()
    fakelog.write("20170809-15:58:34.245 : 8=FIXT.1.19=9835=A34=149=DBL50=SID52=20170809-15:58:34.24556=BME"
                  "57=TID98=0108=30141=Y1137=41408=T4.010=117" + '/n')
    fakelog.write("20170809-15:58:40.333 : 8=FIXT.1.19=9835=A34=149=DBL50=SID52=20170809-15:58:40.33256=BME"
                  "57=TID98=0108=30141=Y1137=41408=T4.010=111" + '/n')
    fakelog.write("20170809-15:59:34.376 : 8=FIXT.1.19=9835=A34=149=DBL50=SID52=20170809-15:59:34.37556=BME"
                  "57=TID98=0108=30141=Y1137=41408=T4.010=122" + '/n')
    test_fix_list = [{'time': '20170809-15:58:34.245', '8':'FIXT.1.1', '9':'98', '35':'A', '34':'1', '49':'DBL',
                      '50':'SID', '52':'20170809-15:58:34.245', '56':'BME', '57':'TID', '98':'0', '108':'30',
                      '141':'Y', '1137':'4', '1408':'T4.0', '10':'117'},
                     {'time': '20170809-15:58:40.333', '8': 'FIXT.1.1', '9': '98', '35': 'A', '34': '1', '49': 'DBL',
                      '50': 'SID', '52': '20170809-15:58:40.332', '56': 'BME', '57': 'TID', '98': '0', '108': '30',
                      '141': 'Y', '1137': '4', '1408': 'T4.0', '10': '111'},
                     {'time': '20170809-15:59:34.376', '8': 'FIXT.1.1', '9': '98', '35': 'A', '34': '1', '49': 'DBL',
                      '50': 'SID', '52': '20170809-15:59:34.375', '56': 'BME', '57': 'TID', '98': '0', '108': '30',
                      '141': 'Y', '1137': '4', '1408': 'T4.0', '10': '122'}
    ]

def test_convert_log(fakelog,test_fix_list):
    cl = convert_log(fakelog)
    for d in test_fix_list:
        assert_dict_equal(test_fix_list,cl)







    #test_fix_list.append(
        #{'time': '20170809-15:58:34.245', '8':'FIXT.1.1', '9':'98', '35':'A', '34':'1', '49':'DBL', '50':'SID',
         #'52':'20170809-15:58:34.245',
         #'56':'BME', '57':'TID', '98':'0', '108':'30', '141':'Y', '1137':'4', '1408':'T4.0', '10':'117'})
        #test_fix_list.append(
        #{'time': '20170809-15:58:40.333', '8': 'FIXT.1.1', '9': '98', '35': 'A', '34': '1', '49': 'DBL', '50': 'SID',
         #'52': '20170809-15:58:40.332',
         #'56': 'BME', '57': 'TID', '98': '0', '108': '30', '141': 'Y', '1137': '4', '1408': 'T4.0', '10': '111'})
        #test_fix_list.append(
        #{'time': '20170809-15:59:34.376', '8': 'FIXT.1.1', '9': '98', '35': 'A', '34': '1', '49': 'DBL', '50': 'SID',
         #'52': '20170809-15:59:34.375',
         #'56': 'BME', '57': 'TID', '98': '0', '108': '30', '141': 'Y', '1137': '4', '1408': 'T4.0', '10': '122'

